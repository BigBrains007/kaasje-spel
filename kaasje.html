<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaasje Spel - Ultimate Edition</title>
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-canvas: linear-gradient(to bottom, #87CEEB 0%, #90EE90 100%);
            --text-primary: #333;
            --text-secondary: #666;
            --card-bg: white;
            --border-color: #fff;
        }
        
        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            --bg-canvas: linear-gradient(to bottom, #0f3460 0%, #16213e 100%);
            --text-primary: #e6e6e6;
            --text-secondary: #a0a0a0;
            --card-bg: #1a1a2e;
            --border-color: #533483;
        }
        
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--bg-primary);
            font-family: 'Arial', sans-serif;
            touch-action: none;
            transition: background 0.3s ease;
        }
        
        #gameContainer {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 500px;
        }
        
        canvas {
            border: 4px solid var(--border-color);
            background: var(--bg-canvas);
            display: block;
            margin: 20px auto;
            max-width: 100%;
            height: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border-radius: 10px;
            transition: background 0.3s ease;
        }
        
        #topBar {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .infoBox {
            background: var(--card-bg);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 100px;
            transition: background 0.3s ease;
        }
        
        .infoLabel {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: bold;
        }
        
        .infoValue {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-primary);
            margin-top: 5px;
        }
        
        #lives {
            font-size: 32px;
            margin: 10px 0;
        }
        
        #dailyChallenge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        #dailyChallenge h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }
        
        #dailyChallenge p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .multiplier {
            display: inline-block;
            background: rgba(255,255,255,0.3);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        #controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        [data-theme="dark"] button {
            background: linear-gradient(135deg, #533483 0%, #7b2cbf 100%);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #themeToggle, #soundBtn, #musicBtn {
            font-size: 20px;
            padding: 10px 20px;
            min-width: 60px;
        }
        
        #gameOver {
            display: none;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            margin: 20px auto;
            max-width: 400px;
            transition: background 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        #gameOver h2 {
            color: #e74c3c;
            margin: 0 0 20px 0;
            font-size: 32px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        [data-theme="dark"] .stat {
            border-bottom: 1px solid #333;
        }
        
        .stat:last-child {
            border-bottom: none;
        }
        
        .statLabel {
            color: var(--text-secondary);
            font-weight: bold;
        }
        
        .statValue {
            color: var(--text-primary);
            font-weight: bold;
        }
        
        #pauseScreen {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
            z-index: 100;
            transition: background 0.3s ease;
        }
        
        #pauseScreen h2 {
            margin: 0 0 20px 0;
            color: var(--text-primary);
        }
        
        #pauseScreen p {
            color: var(--text-secondary);
        }
        
        #powerUpInfo {
            margin: 10px;
            font-size: 18px;
            min-height: 30px;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        [data-theme="dark"] #powerUpInfo {
            color: #ffd700;
        }
        
        #achievements {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            transition: background 0.3s ease;
        }
        
        #achievements h3 {
            margin: 0 0 10px 0;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .achievementGrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
        }
        
        .achievement {
            position: relative;
            font-size: 32px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(0,0,0,0.05);
            opacity: 0.3;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        [data-theme="dark"] .achievement {
            background: rgba(255,255,255,0.05);
        }
        
        .achievement.unlocked {
            opacity: 1;
            transform: scale(1);
        }
        
        .achievement:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
        }
        
        .achievementProgress {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .progressBar {
            width: 100%;
            height: 4px;
            background: rgba(0,0,0,0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 3px;
        }
        
        .progressFill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .level-up {
            animation: levelUpPulse 0.5s ease-in-out;
        }
        
        @keyframes levelUpPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .shake {
            animation: shake 0.3s ease-in-out;
        }
        
        @keyframes unlockPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .newUnlock {
            animation: unlockPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        #achievementPopup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            transition: all 0.5s ease;
        }
        
        #achievementPopup.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        #achievementPopup h3 {
            margin: 0 0 5px 0;
            font-size: 18px;
        }
        
        #achievementPopup p {
            margin: 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="achievementPopup">
        <h3 id="achPopupTitle">üèÜ Achievement Unlocked!</h3>
        <p id="achPopupText">Achievement beschrijving</p>
    </div>
    
    <div id="gameContainer">
        <div id="topBar">
            <div class="infoBox">
                <div class="infoLabel">Score</div>
                <div class="infoValue" id="score">0</div>
            </div>
            <div class="infoBox">
                <div class="infoLabel">Level</div>
                <div class="infoValue" id="level">1</div>
            </div>
            <div class="infoBox">
                <div class="infoLabel">Highscore</div>
                <div class="infoValue" id="highscore">0</div>
            </div>
        </div>
        
        <div id="dailyChallenge">
            <h3 id="challengeTitle">üìÖ Daily Challenge</h3>
            <p id="challengeDesc">Laden...</p>
            <p><span class="multiplier" id="challengeMultiplier">2x Punten!</span></p>
        </div>
        
        <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        
        <div id="powerUpInfo"></div>
        
        <div style="position: relative;">
            <canvas id="gameCanvas" width="400" height="600"></canvas>
            <div id="pauseScreen">
                <h2>‚è∏Ô∏è GEPAUZEERD</h2>
                <p>Druk op SPATIE of tik op het scherm om door te gaan</p>
            </div>
        </div>
        
        <div id="achievements">
            <h3>üèÜ Achievements <span id="achCount">0/12</span></h3>
            <div class="achievementGrid">
                <div class="achievement" id="ach1" title="First Steps: Bereik level 5" data-progress="0">
                    <div>üèÜ</div>
                    <div class="achievementProgress">0/5</div>
                </div>
                <div class="achievement" id="ach2" title="Score Master: Score 50 punten" data-progress="0">
                    <div>‚≠ê</div>
                    <div class="achievementProgress">0/50</div>
                </div>
                <div class="achievement" id="ach3" title="Ball Catcher: Vang 20 ballen" data-progress="0">
                    <div>üéØ</div>
                    <div class="achievementProgress">0/20</div>
                </div>
                <div class="achievement" id="ach4" title="Perfectionist: 100% accuracy (10+ ballen)" data-progress="0">
                    <div>üíØ</div>
                    <div class="achievementProgress">0%</div>
                </div>
                <div class="achievement" id="ach5" title="Power Collector: Vang 10 power-ups" data-progress="0">
                    <div>‚ú®</div>
                    <div class="achievementProgress">0/10</div>
                </div>
                <div class="achievement" id="ach6" title="Sniper: 95% accuracy (20+ ballen)" data-progress="0">
                    <div>üé™</div>
                    <div class="achievementProgress">0%</div>
                </div>
                <div class="achievement" id="ach7" title="Legend: Bereik level 15" data-progress="0">
                    <div>üëë</div>
                    <div class="achievementProgress">0/15</div>
                </div>
                <div class="achievement" id="ach8" title="Century: Score 100 punten" data-progress="0">
                    <div>üíé</div>
                    <div class="achievementProgress">0/100</div>
                </div>
                <div class="achievement" id="ach9" title="Collector: Vang alle 4 bal types" data-progress="0">
                    <div>üåà</div>
                    <div class="achievementProgress">0/4</div>
                </div>
                <div class="achievement" id="ach10" title="Power Master: Gebruik alle power-ups" data-progress="0">
                    <div>‚ö°</div>
                    <div class="achievementProgress">0/4</div>
                </div>
                <div class="achievement" id="ach11" title="Marathon: Vang 50 ballen in √©√©n game" data-progress="0">
                    <div>üèÉ</div>
                    <div class="achievementProgress">0/50</div>
                </div>
                <div class="achievement" id="ach12" title="Unstoppable: Score 200 punten" data-progress="0">
                    <div>üî•</div>
                    <div class="achievementProgress">0/200</div>
                </div>
            </div>
        </div>
        
        <div id="controls">
            <button id="pauseBtn" onclick="togglePause()">‚è∏Ô∏è</button>
            <button id="statsBtn" onclick="toggleStats()">üìä</button>
            <button id="themeToggle" onclick="toggleTheme()">üåô</button>
            <button id="soundBtn" onclick="toggleSound()">üîä</button>
            <button id="musicBtn" onclick="toggleMusic()">üéµ</button>
        </div>
        
        <div id="gameOver">
            <h2>üéÆ GAME OVER!</h2>
            <div class="stat">
                <span class="statLabel">Finale Score:</span>
                <span class="statValue" id="finalScore">0</span>
            </div>
            <div class="stat">
                <span class="statLabel">Level Bereikt:</span>
                <span class="statValue" id="finalLevel">1</span>
            </div>
            <div class="stat">
                <span class="statLabel">Ballen Gevangen:</span>
                <span class="statValue" id="ballenGevangen">0</span>
            </div>
            <div class="stat">
                <span class="statLabel">Ballen Gemist:</span>
                <span class="statValue" id="ballenGemist">0</span>
            </div>
            <div class="stat">
                <span class="statLabel">Nauwkeurigheid:</span>
                <span class="statValue" id="accuracy">0%</span>
            </div>
            <div class="stat">
                <span class="statLabel">Power-ups Gevangen:</span>
                <span class="statValue" id="powerUpsGevangen">0</span>
            </div>
            <div class="stat">
                <span class="statLabel">Achievements Unlocked:</span>
                <span class="statValue" id="achUnlocked">0/12</span>
            </div>
            <button onclick="restartGame()" style="margin-top: 20px; width: 100%;">üîÑ Opnieuw Spelen</button>
        </div>
    </div>

    <script>
        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Audio Context
        let audioContext;
        let soundEnabled = true;
        let musicEnabled = false;
        let musicInterval;
        let currentNote = 0;
        
        // Vrolijke melodie (C major scale met variaties)
        const melody = [
            {freq: 523.25, duration: 0.2}, // C
            {freq: 587.33, duration: 0.2}, // D
            {freq: 659.25, duration: 0.2}, // E
            {freq: 698.46, duration: 0.2}, // F
            {freq: 783.99, duration: 0.4}, // G
            {freq: 659.25, duration: 0.2}, // E
            {freq: 523.25, duration: 0.2}, // C
            {freq: 587.33, duration: 0.4}, // D
        ];
        
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playSound(frequency, duration, type = 'sine', volume = 0.3) {
            if (!soundEnabled) return;
            initAudio();
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playMusicNote() {
            if (!musicEnabled || !spelActief || isPaused) return;
            
            const note = melody[currentNote];
            playSound(note.freq, note.duration, 'sine', 0.15);
            
            currentNote = (currentNote + 1) % melody.length;
        }
        
        function startMusic() {
            if (musicInterval) clearInterval(musicInterval);
            musicInterval = setInterval(playMusicNote, 300);
        }
        
        function stopMusic() {
            if (musicInterval) {
                clearInterval(musicInterval);
                musicInterval = null;
            }
        }
        
        function toggleMusic() {
            musicEnabled = !musicEnabled;
            document.getElementById('musicBtn').textContent = musicEnabled ? 'üéµ' : 'üé∂';
            localStorage.setItem('musicEnabled', musicEnabled);
            
            if (musicEnabled) {
                initAudio();
                startMusic();
            } else {
                stopMusic();
            }
        }
        
        function playCatchSound() {
            playSound(523.25, 0.1, 'sine');
        }
        
        function playPowerUpSound() {
            playSound(659.25, 0.15, 'square');
            setTimeout(() => playSound(783.99, 0.15, 'square'), 100);
        }
        
        function playLoseLifeSound() {
            playSound(220, 0.3, 'sawtooth');
        }
        
        function playGameOverSound() {
            playSound(392, 0.2, 'triangle');
            setTimeout(() => playSound(349.23, 0.2, 'triangle'), 150);
            setTimeout(() => playSound(293.66, 0.4, 'triangle'), 300);
        }
        
        function playLevelUpSound() {
            playSound(523.25, 0.1);
            setTimeout(() => playSound(659.25, 0.1), 100);
            setTimeout(() => playSound(783.99, 0.2), 200);
        }
        
        function playAchievementSound() {
            playSound(783.99, 0.15, 'sine');
            setTimeout(() => playSound(1046.50, 0.15, 'sine'), 100);
            setTimeout(() => playSound(1318.51, 0.3, 'sine'), 200);
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').textContent = soundEnabled ? 'üîä' : 'üîá';
            localStorage.setItem('soundEnabled', soundEnabled);
        }
        
        function vibrate(pattern) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', newTheme);
        }
        
        // Laad voorkeuren
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
        }
        
        const savedSound = localStorage.getItem('soundEnabled');
        if (savedSound === 'false') {
            soundEnabled = false;
            document.getElementById('soundBtn').textContent = 'üîá';
        }
        
        const savedMusic = localStorage.getItem('musicEnabled');
        if (savedMusic === 'true') {
            musicEnabled = true;
            document.getElementById('musicBtn').textContent = 'üéµ';
        }
        
        // Daily Challenge systeem
        const challenges = {
            0: { name: "üåô Sunday Chill", desc: "Normale mode", modifier: 1, special: null },
            1: { name: "‚ö° Speed Monday", desc: "Ballen vallen 50% sneller!", modifier: 1.5, special: 'speed' },
            2: { name: "üíÄ One Life Tuesday", desc: "Slechts 1 leven!", modifier: 3, special: 'onelife' },
            3: { name: "‚ú® Power Wednesday", desc: "2x zoveel power-ups!", modifier: 2, special: 'powerups' },
            4: { name: "üéà Giant Thursday", desc: "Alleen grote ballen!", modifier: 1.5, special: 'giant' },
            5: { name: "üéØ Tiny Friday", desc: "Kleiner gat!", modifier: 2.5, special: 'tinygat' },
            6: { name: "üé™ Chaos Saturday", desc: "Alle modificaties!", modifier: 5, special: 'chaos' }
        };
        
        function getDailyChallenge() {
            const today = new Date().getDay();
            return challenges[today];
        }
        
        const dailyChallenge = getDailyChallenge();
        document.getElementById('challengeTitle').textContent = dailyChallenge.name;
        document.getElementById('challengeDesc').textContent = dailyChallenge.desc;
        document.getElementById('challengeMultiplier').textContent = dailyChallenge.modifier + 'x Punten!';
        
        // Spel variabelen
        let highscore = localStorage.getItem('kaasjeHighscore') || 0;
        document.getElementById('highscore').textContent = highscore;
        
        let score = 0;
        let level = 1;
        let lives = dailyChallenge.special === 'onelife' ? 1 : 3;
        let spelActief = true;
        let isPaused = false;
        let gameStartTime = Date.now();
        
        // Statistieken
        let stats = {
            ballenGevangen: 0,
            ballenGemist: 0,
            powerUpsGevangen: 0,
            totaalBallen: 0,
            balTypesGevangen: new Set(),
            powerUpTypesGevangen: new Set()
        };
        
        // Achievements
        let achievements = JSON.parse(localStorage.getItem('kaasjeAchievements')) || {
            level5: false,
            score50: false,
            catch20: false,
            perfect: false,
            powerup10: false,
            sniper: false,
            level15: false,
            score100: false,
            collector: false,
            powermaster: false,
            marathon: false,
            score200: false
        };
        
        function showAchievementPopup(title, desc) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achPopupTitle').textContent = 'üèÜ ' + title;
            document.getElementById('achPopupText').textContent = desc;
            
            popup.classList.add('show');
            playAchievementSound();
            vibrate([100, 50, 100]);
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }
        
        function updateAchievementProgress() {
            // Progress bars updaten
            const accuracy = stats.totaalBallen > 0 ? 
                Math.round((stats.ballenGevangen / stats.totaalBallen) * 100) : 0;
            
            document.querySelector('#ach1 .achievementProgress').textContent = 
                Math.min(level, 5) + '/5';
            document.querySelector('#ach2 .achievementProgress').textContent = 
                Math.min(score, 50) + '/50';
            document.querySelector('#ach3 .achievementProgress').textContent = 
                Math.min(stats.ballenGevangen, 20) + '/20';
            document.querySelector('#ach4 .achievementProgress').textContent = 
                accuracy + '%';
            document.querySelector('#ach5 .achievementProgress').textContent = 
                Math.min(stats.powerUpsGevangen, 10) + '/10';
            document.querySelector('#ach6 .achievementProgress').textContent = 
                accuracy + '%';
            document.querySelector('#ach7 .achievementProgress').textContent = 
                Math.min(level, 15) + '/15';
            document.querySelector('#ach8 .achievementProgress').textContent = 
                Math.min(score, 100) + '/100';
            document.querySelector('#ach9 .achievementProgress').textContent = 
                stats.balTypesGevangen.size + '/4';
            document.querySelector('#ach10 .achievementProgress').textContent = 
                stats.powerUpTypesGevangen.size + '/4';
            document.querySelector('#ach11 .achievementProgress').textContent = 
                Math.min(stats.ballenGevangen, 50) + '/50';
            document.querySelector('#ach12 .achievementProgress').textContent = 
                Math.min(score, 200) + '/200';
        }
        
        function checkAchievements() {
            let newUnlocks = 0;
            const accuracy = stats.totaalBallen > 0 ? 
                Math.round((stats.ballenGevangen / stats.totaalBallen) * 100) : 0;
            
            if (level >= 5 && !achievements.level5) {
                achievements.level5 = true;
                document.getElementById('ach1').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('First Steps', 'Bereik level 5!');
                newUnlocks++;
            }
            if (score >= 50 && !achievements.score50) {
                achievements.score50 = true;
                document.getElementById('ach2').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Score Master', 'Score 50 punten!');
                newUnlocks++;
            }
            if (stats.ballenGevangen >= 20 && !achievements.catch20) {
                achievements.catch20 = true;
                document.getElementById('ach3').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Ball Catcher', 'Vang 20 ballen!');
                newUnlocks++;
            }
            if (stats.totaalBallen >= 10 && accuracy === 100 && !achievements.perfect) {
                achievements.perfect = true;
                document.getElementById('ach4').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Perfectionist', '100% accuracy!');
                newUnlocks++;
            }
            if (stats.powerUpsGevangen >= 10 && !achievements.powerup10) {
                achievements.powerup10 = true;
                document.getElementById('ach5').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Power Collector', 'Vang 10 power-ups!');
                newUnlocks++;
            }
            if (stats.totaalBallen >= 20 && accuracy >= 95 && !achievements.sniper) {
                achievements.sniper = true;
                document.getElementById('ach6').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Sniper', '95% accuracy!');
                newUnlocks++;
            }
            if (level >= 15 && !achievements.level15) {
                achievements.level15 = true;
                document.getElementById('ach7').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Legend', 'Bereik level 15!');
                newUnlocks++;
            }
            if (score >= 100 && !achievements.score100) {
                achievements.score100 = true;
                document.getElementById('ach8').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Century', 'Score 100 punten!');
                newUnlocks++;
            }
            if (stats.balTypesGevangen.size >= 4 && !achievements.collector) {
                achievements.collector = true;
                document.getElementById('ach9').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Collector', 'Vang alle bal types!');
                newUnlocks++;
            }
            if (stats.powerUpTypesGevangen.size >= 4 && !achievements.powermaster) {
                achievements.powermaster = true;
                document.getElementById('ach10').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Power Master', 'Gebruik alle power-ups!');
                newUnlocks++;
            }
            if (stats.ballenGevangen >= 50 && !achievements.marathon) {
                achievements.marathon = true;
                document.getElementById('ach11').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Marathon', 'Vang 50 ballen in √©√©n game!');
                newUnlocks++;
            }
            if (score >= 200 && !achievements.score200) {
                achievements.score200 = true;
                document.getElementById('ach12').classList.add('unlocked', 'newUnlock');
                showAchievementPopup('Unstoppable', 'Score 200 punten!');
                newUnlocks++;
            }
            
            if (newUnlocks > 0) {
                localStorage.setItem('kaasjeAchievements', JSON.stringify(achievements));
            }
            
            // Update achievement count
            const unlockedCount = Object.values(achievements).filter(v => v).length;
            document.getElementById('achCount').textContent = unlockedCount + '/12';
            
            updateAchievementProgress();
        }
        
        // Load achievements on start
        function loadAchievements() {
            Object.keys(achievements).forEach((key, index) => {
                if (achievements[key]) {
                    document.getElementById('ach' + (index + 1)).classList.add('unlocked');
                }
            });
            checkAchievements();
        }
        
        loadAchievements();
        
        // Bal types
        const balTypes = {
            kaas: {
                emoji: 'üßÄ',
                radius: 15,
                punten: 1,
                snelheidMultiplier: 1,
            },
            pizza: {
                emoji: 'üçï',
                radius: 22,
                punten: 2,
                snelheidMultiplier: 0.8,
            },
            tennis: {
                emoji: 'üéæ',
                radius: 10,
                punten: 3,
                snelheidMultiplier: 1.5,
            },
            voetbal: {
                emoji: '‚öΩ',
                radius: 18,
                punten: 5,
                snelheidMultiplier: 1.2,
            }
        };
        
        let ballen = [];
        
        function maakBal() {
            let type;
            
            // Giant Thursday - alleen grote ballen
            if (dailyChallenge.special === 'giant' || dailyChallenge.special === 'chaos') {
                type = 'pizza';
            } else {
                let rand = Math.random();
                if (rand < 0.5) type = 'kaas';
                else if (rand < 0.7) type = 'pizza';
                else if (rand < 0.9) type = 'tennis';
                else type = 'voetbal';
            }
            
            let balType = balTypes[type];
            let speedMod = dailyChallenge.special === 'speed' || dailyChallenge.special === 'chaos' ? 1.5 : 1;
            
            return {
                x: Math.random() * (canvas.width - 40) + 20,
                y: 50,
                radius: balType.radius,
                snelheid: (2 + (level * 0.3)) * balType.snelheidMultiplier * speedMod,
                type: type,
                punten: balType.punten,
                rotatie: 0,
                rotatieSnelheid: (Math.random() - 0.5) * 0.2
            };
        }
        
        ballen.push(maakBal());
        
        let gat = {
            x: 150,
            y: 500,
            breedte: dailyChallenge.special === 'tinygat' || dailyChallenge.special === 'chaos' ? 60 : 80,
            hoogte: 20,
            normaleBreedte: dailyChallenge.special === 'tinygat' || dailyChallenge.special === 'chaos' ? 60 : 80
        };
        
        // Power-ups
        let powerUps = [];
        let slowModeActief = false;
        let slowModeTimer = 0;
        let bigGatActief = false;
        let bigGatTimer = 0;
        let magneetActief = false;
        let magneetTimer = 0;
        
        function maakPowerUp() {
            let kans = dailyChallenge.special === 'powerups' || dailyChallenge.special === 'chaos' ? 0.6 : 0.3;
            
            if (Math.random() < kans) {
                let rand = Math.random();
                let type;
                
                if (rand < 0.25) type = 'punten';
                else if (rand < 0.5) type = 'slow';
                else if (rand < 0.75) type = 'bigGat';
                else type = 'magneet';
                
                powerUps.push({
                    x: Math.random() * (canvas.width - 40) + 20,
                    y: 50,
                    radius: 12,
                    snelheid: 2,
                    type: type,
                    rotatie: 0
                });
            }
        }
        
        function tekenPowerUps() {
            powerUps.forEach(powerUp => {
                ctx.save();
                ctx.translate(powerUp.x, powerUp.y);
                
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                let emoji;
                switch(powerUp.type) {
                    case 'punten': emoji = 'üåü'; break;
                    case 'slow': emoji = '‚è±Ô∏è'; break;
                    case 'bigGat': emoji = 'üîç'; break;
                    case 'magneet': emoji = 'üß≤'; break;
                }
                
                ctx.fillText(emoji, 0, 0);
                powerUp.rotatie += 0.05;
                ctx.restore();
            });
        }
        
        function updatePowerUps() {
            for (let i = powerUps.length - 1; i >= 0; i--) {
                let powerUp = powerUps[i];
                powerUp.y += powerUp.snelheid;
                
                if (magneetActief) {
                    let dx = (gat.x + gat.breedte / 2) - powerUp.x;
                    powerUp.x += dx * 0.05;
                }
                
                if (powerUp.y + powerUp.radius >= gat.y) {
                    if (powerUp.x > gat.x && powerUp.x < gat.x + gat.breedte) {
                        stats.powerUpsGevangen++;
                        stats.powerUpTypesGevangen.add(powerUp.type);
                        playPowerUpSound();
                        
                        switch(powerUp.type) {
                            case 'punten':
                                score += Math.floor(5 * dailyChallenge.modifier);
                                updateScore();
                                toonPowerUpBericht('üåü +' + Math.floor(5 * dailyChallenge.modifier) + ' Bonus Punten!');
                                break;
                            case 'slow':
                                activeerSlowMode();
                                toonPowerUpBericht('‚è±Ô∏è Slow Motion!');
                                break;
                            case 'bigGat':
                                activeerBigGat();
                                toonPowerUpBericht('üîç Groter Gat!');
                                break;
                            case 'magneet':
                                activeerMagneet();
                                toonPowerUpBericht('üß≤ Magneet Power!');
                                break;
                        }
                        
                        powerUps.splice(i, 1);
                        checkAchievements();
                    } else if (powerUp.y > canvas.height) {
                        powerUps.splice(i, 1);
                    }
                }
            }
            
            if (slowModeActief) {
                slowModeTimer--;
                if (slowModeTimer <= 0) deactiveerSlowMode();
            }
            if (bigGatActief) {
                bigGatTimer--;
                if (bigGatTimer <= 0) deactiveerBigGat();
            }
            if (magneetActief) {
                magneetTimer--;
                if (magneetTimer <= 0) deactiveerMagneet();
            }
        }
        
        function activeerSlowMode() {
            slowModeActief = true;
            slowModeTimer = 180;
            ballen.forEach(bal => {
                bal.snelheid = bal.snelheid / 2;
            });
        }
        
        function deactiveerSlowMode() {
            slowModeActief = false;
            ballen.forEach(bal => {
                let balType = balTypes[bal.type];
                let speedMod = dailyChallenge.special === 'speed' || dailyChallenge.special === 'chaos' ? 1.5 : 1;
                bal.snelheid = (2 + (level * 0.3)) * balType.snelheidMultiplier * speedMod;
            });
        }
        
        function activeerBigGat() {
            bigGatActief = true;
            bigGatTimer = 300;
            gat.breedte = 140;
        }
        
        function deactiveerBigGat() {
            bigGatActief = false;
            gat.breedte = gat.normaleBreedte;
        }
        
        function activeerMagneet() {
            magneetActief = true;
            magneetTimer = 240;
        }
        
        function deactiveerMagneet() {
            magneetActief = false;
        }
        
        function toonPowerUpBericht(tekst) {
            document.getElementById('powerUpInfo').textContent = tekst;
            setTimeout(() => {
                if (!slowModeActief && !bigGatActief && !magneetActief) {
                    document.getElementById('powerUpInfo').textContent = '';
                }
            }, 2000);
        }
        
        function updateScore() {
            document.getElementById('score').textContent = score;
            
            let nieuwLevel = Math.floor(score / 5) + 1;
            if (nieuwLevel > level) {
                level = nieuwLevel;
                document.getElementById('level').textContent = level;
                document.getElementById('level').parentElement.classList.add('level-up');
                setTimeout(() => {
                    document.getElementById('level').parentElement.classList.remove('level-up');
                }, 500);
                playLevelUpSound();
                toonPowerUpBericht('üéä LEVEL ' + level + '! üéä');
                
                if (level % 3 === 0 && ballen.length < 4) {
                    ballen.push(maakBal());
                    toonPowerUpBericht('‚ö†Ô∏è Extra Bal! ‚ö†Ô∏è');
                }
                
                checkAchievements();
            }
            
            if (score > highscore) {
                highscore = score;
                document.getElementById('highscore').textContent = highscore;
                localStorage.setItem('kaasjeHighscore', highscore);
            }
            
            checkAchievements();
        }
        
        function updateLives() {
            const maxLives = dailyChallenge.special === 'onelife' ? 1 : 3;
            const hearts = [];
            for (let i = 0; i < maxLives; i++) {
                hearts.push(i < lives ? '‚ù§Ô∏è' : 'üñ§');
            }
            document.getElementById('lives').textContent = hearts.join('');
        }
        
        updateLives();
        
        // Controls
        canvas.addEventListener('mousemove', function(e) {
            if (!isPaused) {
                const rect = canvas.getBoundingClientRect();
                gat.x = e.clientX - rect.left - gat.breedte / 2;
            }
        });
        
        canvas.addEventListener('touchmove', function(e) {
            if (!isPaused) {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                gat.x = touch.clientX - rect.left - gat.breedte / 2;
            }
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && spelActief) {
                e.preventDefault();
                togglePause();
            }
        });
        
        canvas.addEventListener('click', function() {
            if (!spelActief) {
                restartGame();
            } else if (isPaused) {
                togglePause();
            }
        });
        
        function togglePause() {
            if (!spelActief) return;
            
            isPaused = !isPaused;
            document.getElementById('pauseScreen').style.display = isPaused ? 'block' : 'none';
            document.getElementById('pauseBtn').textContent = isPaused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
            
            if (!isPaused) {
                gameLoop();
                if (musicEnabled) startMusic();
            } else {
                stopMusic();
            }
        }
        
        function tekenBal(bal) {
            let balType = balTypes[bal.type];
            
            ctx.save();
            ctx.translate(bal.x, bal.y);
            ctx.rotate(bal.rotatie);
            
            ctx.font = (bal.radius * 2) + 'px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(balType.emoji, 0, 0);
            
            bal.rotatie += bal.rotatieSnelheid;
            ctx.restore();
        }
        
        function tekenGat() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(gat.x - 2, gat.y + gat.hoogte, gat.breedte + 4, 5);
            
            ctx.fillStyle = bigGatActief ? '#FFD700' : '#8B4513';
            ctx.fillRect(gat.x, gat.y, gat.breedte, gat.hoogte);
            
            ctx.strokeStyle = bigGatActief ? '#FFA500' : '#654321';
            ctx.lineWidth = bigGatActief ? 3 : 2;
            ctx.strokeRect(gat.x, gat.y, gat.breedte, gat.hoogte);
            
            if (magneetActief) {
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üß≤', gat.x + gat.breedte / 2, gat.y - 15);
            }
        }
        
        function updateBallen() {
            for (let i = ballen.length - 1; i >= 0; i--) {
                let bal = ballen[i];
                bal.y += bal.snelheid;
                
                if (magneetActief && bal.y > canvas.height / 2) {
                    let dx = (gat.x + gat.breedte / 2) - bal.x;
                    bal.x += dx * 0.03;
                }
                
                if (bal.y + bal.radius >= gat.y) {
                    if (bal.x > gat.x && bal.x < gat.x + gat.breedte) {
                        score += Math.floor(bal.punten * dailyChallenge.modifier);
                        stats.ballenGevangen++;
                        stats.totaalBallen++;
                        stats.balTypesGevangen.add(bal.type);
                        playCatchSound();
                        updateScore();
                        
                        ballen.splice(i, 1);
                        ballen.push(maakBal());
                        maakPowerUp();
                    } else if (bal.y - bal.radius > canvas.height) {
                        stats.ballenGemist++;
                        stats.totaalBallen++;
                        lives--;
                        updateLives();
                        playLoseLifeSound();
                        vibrate([200]);
                        
                        document.getElementById('lives').classList.add('shake');
                        setTimeout(() => {
                            document.getElementById('lives').classList.remove('shake');
                        }, 300);
                        
                        ballen.splice(i, 1);
                        
                        if (lives <= 0) {
                            gameOver();
                        } else {
                            ballen.push(maakBal());
                        }
                    }
                }
            }
        }
        
        function gameOver() {
            spelActief = false;
            playGameOverSound();
            stopMusic();
            vibrate([100, 50, 100, 50, 200]);
            
            let accuracy = stats.totaalBallen > 0 ? 
                Math.round((stats.ballenGevangen / stats.totaalBallen) * 100) : 0;
            
            const unlockedCount = Object.values(achievements).filter(v => v).length;
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('ballenGevangen').textContent = stats.ballenGevangen;
            document.getElementById('ballenGemist').textContent = stats.ballenGemist;
            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('powerUpsGevangen').textContent = stats.powerUpsGevangen;
            document.getElementById('achUnlocked').textContent = unlockedCount + '/12';
            
            document.getElementById('gameOver').style.display = 'block';
            
            // Check achievements one last time
            checkAchievements();
        }
        
        function toggleStats() {
            let gameOverDiv = document.getElementById('gameOver');
            if (gameOverDiv.style.display === 'block') {
                gameOverDiv.style.display = 'none';
            } else {
                let accuracy = stats.totaalBallen > 0 ? 
                    Math.round((stats.ballenGevangen / stats.totaalBallen) * 100) : 0;
                
                const unlockedCount = Object.values(achievements).filter(v => v).length;
                
                document.getElementById('finalScore').textContent = score;
                document.getElementById('finalLevel').textContent = level;
                document.getElementById('ballenGevangen').textContent = stats.ballenGevangen;
                document.getElementById('ballenGemist').textContent = stats.ballenGemist;
                document.getElementById('accuracy').textContent = accuracy + '%';
                document.getElementById('powerUpsGevangen').textContent = stats.powerUpsGevangen;
                document.getElementById('achUnlocked').textContent = unlockedCount + '/12';
                
                gameOverDiv.querySelector('h2').textContent = 'üìä STATISTIEKEN';
                gameOverDiv.querySelector('button').textContent = '‚ùå Sluiten';
                gameOverDiv.style.display = 'block';
            }
        }
        
        function restartGame() {
            spelActief = true;
            isPaused = false;
            score = 0;
            level = 1;
            lives = dailyChallenge.special === 'onelife' ? 1 : 3;
            ballen = [maakBal()];
            powerUps = [];
            slowModeActief = false;
            bigGatActief = false;
            magneetActief = false;
            gat.breedte = gat.normaleBreedte;
            gameStartTime = Date.now();
            
            stats = {
                ballenGevangen: 0,
                ballenGemist: 0,
                powerUpsGevangen: 0,
                totaalBallen: 0,
                balTypesGevangen: new Set(),
                powerUpTypesGevangen: new Set()
            };
            
            updateScore();
            updateLives();
            document.getElementById('level').textContent = 1;
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('gameOver').querySelector('h2').textContent = 'üéÆ GAME OVER!';
            document.getElementById('gameOver').querySelector('button').textContent = 'üîÑ Opnieuw Spelen';
            document.getElementById('pauseScreen').style.display = 'none';
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è';
            document.getElementById('powerUpInfo').textContent = '';
            
            if (musicEnabled) startMusic();
            gameLoop();
        }
        
        function gameLoop() {
            if (!spelActief || isPaused) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            tekenGat();
            ballen.forEach(bal => tekenBal(bal));
            tekenPowerUps();
            
            updateBallen();
            updatePowerUps();
            
            requestAnimationFrame(gameLoop);
        }
        
        // Start muziek als enabled
        if (musicEnabled) {
            initAudio();
            startMusic();
        }
        
        gameLoop();
    </script>
</body>
</html>